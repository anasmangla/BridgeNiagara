<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Donate - Bridge Niagara Foundation</title>
  <link rel="stylesheet" href="css/tailwind.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
  <style>body { font-family: 'Inter', sans-serif; }</style>
</head>
<body class="bg-white text-gray-800">
  <!-- Consistent Navigation Bar -->
  <div id="header"></div>

  <main class="max-w-2xl mx-auto px-4 py-10">
    <h1 class="text-3xl font-bold text-green-700 mb-6 text-center">Support Our Mission</h1>

    <form id="donation-form" class="space-y-6">
      <div>
        <label class="block text-lg font-semibold">Choose Amount</label>
        <div class="flex flex-wrap gap-4 mt-2">
          <button type="button" class="amount-btn bg-gray-200 text-gray-800 px-4 py-2 rounded" data-value="10000">$100</button>
          <button type="button" class="amount-btn bg-gray-200 text-gray-800 px-4 py-2 rounded" data-value="50000">$500</button>
          <button type="button" class="amount-btn bg-gray-200 text-gray-800 px-4 py-2 rounded" data-value="100000">$1000</button>
          <button type="button" class="amount-btn bg-gray-200 text-gray-800 px-4 py-2 rounded" data-value="150000">$1500</button>
          <button type="button" class="amount-btn bg-gray-200 text-gray-800 px-4 py-2 rounded" data-value="200000">$2000</button>
        </div>
        <input type="hidden" name="amount" id="amount">
        <input type="number" name="custom_amount" placeholder="Or enter custom amount" class="w-full border px-4 py-2 mt-4" min="1">
      </div>

      <div>
        <label class="text-lg font-semibold">One-time or Monthly?</label>
        <div class="flex gap-4 mt-2">
          <button type="button" class="donate-tab bg-green-700 text-white px-4 py-2 rounded" data-mode="payment">One-Time</button>
          <button type="button" class="donate-tab bg-gray-200 text-gray-800 px-4 py-2 rounded" data-mode="subscription">Monthly</button>
        </div>
        <input type="hidden" name="mode" id="donation-mode" value="payment">
      </div>

      <fieldset>
        <legend class="text-lg font-semibold">Your Info (Optional)</legend>
        <input type="text" name="name" placeholder="Name" class="w-full border px-4 py-2 mt-2">
        <input type="email" name="email" placeholder="Email for receipt" class="w-full border px-4 py-2 mt-2">
        <input type="tel" name="phone" placeholder="Phone Number" class="w-full border px-4 py-2 mt-2">
      </fieldset>

      <button type="submit" class="w-full bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded shadow transition">Donate Now</button>
    </form>
  </main>

<div id="footer"></div>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const tabs = document.querySelectorAll('.donate-tab');
      const modeInput = document.getElementById('donation-mode');
      const form = document.getElementById('donation-form');
      const amountButtons = document.querySelectorAll('.amount-btn');
      const amountInput = document.getElementById('amount');
      const customInput = document.querySelector('input[name="custom_amount"]');

      amountButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          amountButtons.forEach(b => b.classList.remove('bg-green-700', 'text-white'));
          btn.classList.add('bg-green-700', 'text-white');
          amountInput.value = btn.dataset.value;
          if (customInput) customInput.value = '';
        });
      });

      if (customInput) {
        customInput.addEventListener('input', () => {
          amountInput.value = '';
          amountButtons.forEach(b => b.classList.remove('bg-green-700', 'text-white'));
        });
      }

      // Determine base URL from environment or current origin
      const SERVER_URL =
        (typeof window !== 'undefined' && window.SERVER_URL) ||
        (typeof process !== 'undefined' && process.env && process.env.SERVER_URL) ||
        window.location.origin;

      // Prefill donation amount from query parameter
      const params = new URLSearchParams(window.location.search);
      const amountParam = params.get('amount');
      if (amountParam) {
        const presetValues = ['10000', '50000', '100000', '150000', '200000'];
        if (presetValues.includes(amountParam)) {
          const btn = document.querySelector(`.amount-btn[data-value="${amountParam}"]`);
          if (btn) btn.click();
        } else if (customInput) {
          customInput.value = amountParam;
        }
      }

      // Tab switching logic
      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          tabs.forEach(t => {
            t.classList.remove('bg-green-700', 'text-white');
            t.classList.add('bg-gray-200', 'text-gray-800');
          });
          tab.classList.remove('bg-gray-200', 'text-gray-800');
          tab.classList.add('bg-green-700', 'text-white');
          modeInput.value = tab.dataset.mode;
        });
      });

      // Submit logic
      form.addEventListener('submit', async e => {
        e.preventDefault();
        const data = Object.fromEntries(new FormData(e.target).entries());
        if (!data.amount) {
          const custom = parseFloat(data.custom_amount || '0');
          data.amount = Math.round(custom * 100);
        } else {
          data.amount = parseInt(data.amount, 10);
        }
        delete data.custom_amount;

        data.mode = data.mode === 'subscription' ? 'subscription' : 'payment';

        try {
          const res = await fetch(`${SERVER_URL}/create-checkout-session`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });
          const { url } = await res.json();
          if (url) window.location.href = url;
          else alert('Something went wrong. Please try again.');
        } catch (err) {
          console.error('Error:', err);
          alert('An error occurred while processing your donation.');
        }
      });
    });
  </script>

  <script src="js/header.js"></script>
<script src="js/footer.js"></script>
</body>
</html>
